<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack AI - Card Counting Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background: #1a0a0a;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(139, 0, 0, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(139, 0, 0, 0.08) 0%, transparent 50%),
                linear-gradient(180deg, #0a0a0a 0%, #1a0a0a 50%, #0a0a0a 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #8b0000 0%, #a52a2a 50%, #8b0000 100%);
            border-radius: 15px;
            border: 2px solid #b8860b;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }

        h1 {
            font-size: 2.8em;
            margin-bottom: 5px;
            color: #daa520;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            letter-spacing: 2px;
            font-weight: bold;
        }

        .subtitle {
            font-size: 1.05em;
            color: #d4af37;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            font-style: italic;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 320px 1fr 320px;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: linear-gradient(135deg, #1a0000 0%, #2d0000 100%);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #8b0000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }

        .panel h2 {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #daa520;
            border-bottom: 2px solid #b8860b;
            padding-bottom: 10px;
            letter-spacing: 1px;
        }

        .game-area {
            min-height: 600px;
        }

        .table {
            background: radial-gradient(ellipse at center, #0d5c3d 0%, #0a4a30 100%);
            border-radius: 200px;
            padding: 40px;
            margin: 20px 0;
            border: 12px solid #654321;
            box-shadow: 
                0 0 0 3px #8b4513,
                0 15px 40px rgba(0,0,0,0.6),
                inset 0 0 80px rgba(0,0,0,0.3);
            position: relative;
        }

        .table::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 85%;
            border: 2px dashed rgba(218, 165, 32, 0.15);
            border-radius: 200px;
            pointer-events: none;
        }

        .dealer-area, .player-area {
            text-align: center;
            margin: 30px 0;
            position: relative;
            z-index: 1;
        }

        .dealer-area h3, .player-area h3 {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #daa520;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
            letter-spacing: 1px;
        }

        .cards {
            display: flex;
            justify-content: center;
            gap: -20px;
            flex-wrap: wrap;
            min-height: 160px;
            align-items: center;
            perspective: 1000px;
        }

        .card {
            width: 100px;
            height: 140px;
            background: linear-gradient(135deg, #fff 0%, #f5f5f5 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            font-weight: bold;
            box-shadow: 
                0 8px 20px rgba(0,0,0,0.5),
                inset 0 1px 0 rgba(255,255,255,0.8),
                inset 0 -1px 0 rgba(0,0,0,0.2);
            animation: dealCard 0.4s ease-out;
            position: relative;
            border: 3px solid #ddd;
            margin: 0 -15px;
            transition: transform 0.2s, margin 0.2s;
        }

        .card:hover {
            transform: translateY(-8px) scale(1.03);
            margin: 0 5px;
            z-index: 10;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        @keyframes dealCard {
            from {
                transform: translateY(-150px) rotate(90deg);
                opacity: 0;
            }
            to {
                transform: translateY(0) rotate(0);
                opacity: 1;
            }
        }

        .card.hearts, .card.diamonds {
            color: #dc143c;
        }

        .card.spades, .card.clubs {
            color: #000;
        }

        .card-back {
            background: 
                linear-gradient(45deg, #8b0000 25%, transparent 25%),
                linear-gradient(-45deg, #8b0000 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #8b0000 75%),
                linear-gradient(-45deg, transparent 75%, #8b0000 75%),
                linear-gradient(#a52a2a, #a52a2a);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            color: white;
            border: 3px solid #b8860b;
        }

        .hand-value {
            font-size: 1.5em;
            margin-top: 15px;
            font-weight: bold;
            color: #daa520;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
            padding: 8px 20px;
            background: rgba(0,0,0,0.4);
            border-radius: 20px;
            display: inline-block;
            border: 2px solid rgba(218, 165, 32, 0.3);
        }

        .result-message {
            text-align: center;
            font-size: 2em;
            margin: 20px 0;
            padding: 20px;
            border-radius: 15px;
            font-weight: bold;
            animation: fadeIn 0.5s;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            border: 3px solid;
            letter-spacing: 1px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .result-message.win {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            border-color: #1e8449;
        }

        .result-message.lose {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border-color: #8b0000;
        }

        .result-message.push {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            border-color: #d68910;
        }

        .result-message.satout {
            background: linear-gradient(135deg, #7f8c8d 0%, #95a5a6 100%);
            color: white;
            border-color: #5d6d7e;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 12px;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0.5) 100%);
            border-radius: 8px;
            border: 1px solid rgba(139, 0, 0, 0.5);
            transition: all 0.2s;
        }

        .stat-item:hover {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.6) 100%);
            border-color: #b8860b;
        }

        .stat-label {
            font-weight: 600;
            color: #d4af37;
        }

        .stat-value {
            font-weight: bold;
            color: #daa520;
            font-size: 1.1em;
        }

        .stat-value.positive {
            color: #2ecc71;
        }

        .stat-value.negative {
            color: #e74c3c;
        }

        .count-display {
            text-align: center;
            margin: 20px 0;
            padding: 18px;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.6) 100%);
            border-radius: 15px;
            border: 2px solid #8b0000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }

        .count-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #daa520;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }

        .count-label {
            font-size: 0.95em;
            color: #d4af37;
            margin-top: 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            letter-spacing: 0.5px;
        }

        button {
            background: linear-gradient(135deg, #daa520 0%, #b8860b 100%);
            color: #000;
            border: none;
            padding: 14px 28px;
            font-size: 1.05em;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(218, 165, 32, 0.3);
            width: 100%;
            margin: 5px 0;
            border: 2px solid #9d7a1a;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            letter-spacing: 0.5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(218, 165, 32, 0.4);
            background: linear-gradient(135deg, #f0c419 0%, #daa520 100%);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            background: linear-gradient(135deg, #888 0%, #666 100%);
        }

        .controls {
            margin-top: 20px;
        }

        .settings-form {
            display: grid;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #daa520;
            letter-spacing: 0.5px;
        }

        .form-group input[type="number"] {
            padding: 11px;
            border-radius: 8px;
            border: 2px solid #8b0000;
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(240,240,240,0.95) 100%);
            font-size: 1.05em;
            font-weight: bold;
            color: #000;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .form-group input[type="number"]:focus {
            outline: none;
            border-color: #b8860b;
            box-shadow: 0 0 8px rgba(218, 165, 32, 0.3);
        }

        .form-group input[type="checkbox"] {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #daa520;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .auto-play-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .auto-play-controls input {
            flex: 1;
            padding: 11px;
            border-radius: 8px;
            border: 2px solid #8b0000;
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(240,240,240,0.95) 100%);
            font-size: 1.05em;
            font-weight: bold;
            color: #000;
        }

        .info-box {
            padding: 14px;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.2) 0%, rgba(0, 0, 0, 0.3) 100%);
            border-left: 4px solid #a52a2a;
            border-radius: 5px;
            margin: 15px 0;
            border: 2px solid rgba(139, 0, 0, 0.3);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .info-box strong {
            color: #daa520;
        }

        .info-box ul {
            margin-left: 20px;
        }

        .bet-info {
            text-align: center;
            font-size: 1.4em;
            margin: 18px 0;
            padding: 14px;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.6) 100%);
            border-radius: 15px;
            border: 2px solid #8b0000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }

        .bet-info .amount {
            color: #daa520;
            font-weight: bold;
            font-size: 1.4em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }

        .actions-list {
            text-align: center;
            margin: 12px 0;
            color: #d4af37;
            font-style: italic;
            font-size: 1.05em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }

        .progress-bar {
            width: 100%;
            height: 22px;
            background: rgba(0,0,0,0.5);
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
            border: 2px solid #8b0000;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.4);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71 0%, #27ae60 100%);
            transition: width 0.3s ease;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.6em;
            color: #daa520;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 12px;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0.5) 100%);
            border-radius: 8px;
            border: 1px solid rgba(139, 0, 0, 0.5);
            transition: all 0.2s;
        }

        .stat-item:hover {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.6) 100%);
            border-color: #b8860b;
        }

        .stat-label {
            font-weight: 600;
            color: #d4af37;
        }

        .stat-value {
            font-weight: bold;
            color: #daa520;
            font-size: 1.1em;
        }

        .stat-value.positive {
            color: #2ecc71;
        }

        .stat-value.negative {
            color: #e74c3c;
        }

        .count-display {
            text-align: center;
            margin: 20px 0;
            padding: 18px;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.6) 100%);
            border-radius: 15px;
            border: 2px solid #8b0000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }

        .count-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #daa520;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }

        .count-label {
            font-size: 0.95em;
            color: #d4af37;
            margin-top: 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            letter-spacing: 0.5px;
        }

        button {
            background: linear-gradient(135deg, #daa520 0%, #b8860b 100%);
            color: #000;
            border: none;
            padding: 14px 28px;
            font-size: 1.05em;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(218, 165, 32, 0.3);
            width: 100%;
            margin: 5px 0;
            border: 2px solid #9d7a1a;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            letter-spacing: 0.5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(218, 165, 32, 0.4);
            background: linear-gradient(135deg, #f0c419 0%, #daa520 100%);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            background: linear-gradient(135deg, #888 0%, #666 100%);
        }

        .controls {
            margin-top: 20px;
        }

        .settings-form {
            display: grid;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #daa520;
            letter-spacing: 0.5px;
        }

        .form-group input[type="number"] {
            padding: 11px;
            border-radius: 8px;
            border: 2px solid #8b0000;
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(240,240,240,0.95) 100%);
            font-size: 1.05em;
            font-weight: bold;
            color: #000;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .form-group input[type="number"]:focus {
            outline: none;
            border-color: #b8860b;
            box-shadow: 0 0 8px rgba(218, 165, 32, 0.3);
        }

        .form-group input[type="checkbox"] {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #daa520;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .auto-play-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .auto-play-controls input {
            flex: 1;
            padding: 11px;
            border-radius: 8px;
            border: 2px solid #8b0000;
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(240,240,240,0.95) 100%);
            font-size: 1.05em;
            font-weight: bold;
            color: #000;
        }

        .info-box {
            padding: 14px;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.2) 0%, rgba(0, 0, 0, 0.3) 100%);
            border-left: 4px solid #a52a2a;
            border-radius: 5px;
            margin: 15px 0;
            border: 2px solid rgba(139, 0, 0, 0.3);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .info-box strong {
            color: #daa520;
        }

        .info-box ul {
            margin-left: 20px;
        }

        .bet-info {
            text-align: center;
            font-size: 1.4em;
            margin: 18px 0;
            padding: 14px;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.6) 100%);
            border-radius: 15px;
            border: 2px solid #8b0000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }

        .bet-info .amount {
            color: #daa520;
            font-weight: bold;
            font-size: 1.4em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }

        .actions-list {
            text-align: center;
            margin: 12px 0;
            color: #d4af37;
            font-style: italic;
            font-size: 1.05em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }

        .progress-bar {
            width: 100%;
            height: 22px;
            background: rgba(0,0,0,0.5);
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
            border: 2px solid #8b0000;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.4);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71 0%, #27ae60 100%);
            transition: width 0.3s ease;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.6em;
            color: #daa520;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>♠️ ♥️ CAM'S BLACKJACK AI ♦️ ♣️</h1>
            <p class="subtitle">Professional Card Counting • Live Casino Experience • Real-Time Strategy</p>
        </header>

        <div class="main-grid">
            <!-- Left Panel - Settings & Controls -->
            <div class="panel">
                <h2>⚙️ GAME SETTINGS</h2>
                
                <div class="settings-form">
                    <div class="form-group">
                        <label>Starting Bankroll ($)</label>
                        <input type="number" id="bankroll" value="1000" step="100">
                    </div>
                    
                    <div class="form-group">
                        <label>Base Bet ($)</label>
                        <input type="number" id="baseBet" value="10" step="5">
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="useCardCounting" checked>
                            <label for="useCardCounting">Card Counting</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="useWonging" checked>
                            <label for="useWonging">Wonging (Sit Out)</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Wonging Threshold</label>
                        <input type="number" id="wongingThreshold" value="-1" step="0.5">
                    </div>
                </div>

                <div class="controls">
                    <button id="newGameBtn" onclick="startNewGame()">🎮 NEW GAME</button>
                    <button id="playHandBtn" onclick="playHand()" disabled>▶️ PLAY HAND</button>
                    
                    <div class="auto-play-controls">
                        <input type="number" id="autoPlayHands" value="10" min="1" max="100" placeholder="# hands">
                        <button id="autoPlayBtn" onclick="startAutoPlay()" disabled>⚡ AUTO PLAY</button>
                    </div>
                    <button id="stopAutoBtn" onclick="stopAutoPlay()" style="display:none; background: #e74c3c;">⏹️ STOP</button>
                </div>

                <div class="info-box">
                    <strong>How it works:</strong>
                    <ul style="margin-top: 10px; line-height: 1.6;">
                        <li>AI uses Hi-Lo counting system</li>
                        <li>Bets more when count is high</li>
                        <li>Sits out when count is bad</li>
                        <li>Follows optimal basic strategy</li>
                    </ul>
                </div>
            </div>

            <!-- Center Panel - Game Area -->
            <div class="panel game-area">
                <h2>🎴 CASINO TABLE</h2>
                
                <div id="loadingMessage" class="loading">
                    Click "NEW GAME" to start!
                </div>

                <div id="gameContent" style="display: none;">
                    <div class="count-display">
                        <div>
                            <span class="count-label">Running Count:</span>
                            <span class="count-value" id="runningCount">0</span>
                        </div>
                        <div>
                            <span class="count-label">True Count:</span>
                            <span class="count-value" id="trueCount">0.0</span>
                        </div>
                        <div>
                            <span class="count-label">Decks Remaining:</span>
                            <span class="count-value" id="decksRemaining">6.0</span>
                        </div>
                    </div>

                    <div id="resultMessage"></div>

                    <div class="table">
                        <!-- Dealer Area -->
                        <div class="dealer-area">
                            <h3>DEALER</h3>
                            <div class="cards" id="dealerCards"></div>
                            <div class="hand-value" id="dealerValue"></div>
                        </div>

                        <!-- Player Area -->
                        <div class="player-area">
                            <h3>AI PLAYER</h3>
                            <div class="cards" id="playerCards"></div>
                            <div class="hand-value" id="playerValue"></div>
                            <div class="actions-list" id="actionsList"></div>
                        </div>
                    </div>

                    <div class="bet-info">
                        <span>Bet: <span class="amount" id="betAmount">$0</span></span>
                        <span id="betMultiplier" style="margin-left: 20px; color: #aaa;"></span>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Statistics -->
            <div class="panel">
                <h2>💰 PLAYER STATS</h2>
                
                <div id="stats">
                    <div class="stat-item">
                        <span class="stat-label">Bankroll:</span>
                        <span class="stat-value" id="statBankroll">$0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Profit/Loss:</span>
                        <span class="stat-value" id="statProfit">$0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ROI:</span>
                        <span class="stat-value" id="statROI">0%</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Hands Played:</span>
                        <span class="stat-value" id="statHandsPlayed">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Hands Sat Out:</span>
                        <span class="stat-value" id="statHandsSat">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Win Rate:</span>
                        <span class="stat-value" id="statWinRate">0%</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Total Wagered:</span>
                        <span class="stat-value" id="statTotalWagered">$0</span>
                    </div>
                </div>

                <h2 style="margin-top: 30px;">💎 BANKROLL HISTORY</h2>
                <div class="stat-item">
                    <span class="stat-label">Max Bankroll:</span>
                    <span class="stat-value positive" id="statMaxBankroll">$0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Min Bankroll:</span>
                    <span class="stat-value negative" id="statMinBankroll">$0</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let autoPlayInterval = null;
        let autoPlayCount = 0;
        let autoPlayTarget = 0;

        async function startNewGame() {
            const settings = {
                bankroll: parseFloat(document.getElementById('bankroll').value),
                baseBet: parseFloat(document.getElementById('baseBet').value),
                useCardCounting: document.getElementById('useCardCounting').checked,
                useWonging: document.getElementById('useWonging').checked,
                wongingThreshold: parseFloat(document.getElementById('wongingThreshold').value),
                penetration: 0.75
            };

            const response = await fetch('/api/new-game', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(settings)
            });

            if (response.ok) {
                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('gameContent').style.display = 'block';
                document.getElementById('playHandBtn').disabled = false;
                document.getElementById('autoPlayBtn').disabled = false;
                
                clearTable();
                await updateStats();
                
                document.getElementById('resultMessage').innerHTML = '<div class="result-message" style="background: #3498db;">Ready to play! Click PLAY HAND</div>';
            }
        }

        async function playHand() {
            document.getElementById('playHandBtn').disabled = true;
            
            clearTable();
            document.getElementById('resultMessage').innerHTML = '';

            const response = await fetch('/api/play-hand', {
                method: 'POST'
            });

            const data = await response.json();

            if (data.satOut) {
                displaySatOut(data.handData);
            } else {
                displayHand(data.handData);
            }

            await updateStats();
            
            document.getElementById('playHandBtn').disabled = false;
        }

        function displaySatOut(hand) {
            document.getElementById('resultMessage').innerHTML = 
                `<div class="result-message satout">
                    SITTING OUT - Count too negative (${hand.trueCount >= 0 ? '+' : ''}${hand.trueCount.toFixed(1)})
                </div>`;

            // Show burned cards
            const playerCardsDiv = document.getElementById('playerCards');
            hand.burnedCards.forEach(card => {
                playerCardsDiv.innerHTML += createCardHTML(card);
            });

            document.getElementById('betAmount').textContent = '$0';
            document.getElementById('betMultiplier').textContent = '(Wonging out)';
        }

        function displayHand(hand) {
            // Update count display
            document.getElementById('runningCount').textContent = hand.runningCount >= 0 ? '+' + hand.runningCount : hand.runningCount;
            document.getElementById('trueCount').textContent = hand.trueCount >= 0 ? '+' + hand.trueCount.toFixed(1) : hand.trueCount.toFixed(1);
            document.getElementById('decksRemaining').textContent = hand.decksRemaining.toFixed(1);

            // Display bet
            document.getElementById('betAmount').textContent = '$' + hand.bet.toFixed(2);
            if (hand.betMultiplier > 1) {
                document.getElementById('betMultiplier').textContent = `(${hand.betMultiplier.toFixed(0)}x base bet)`;
            } else {
                document.getElementById('betMultiplier').textContent = '';
            }

            // Display cards
            const playerCardsDiv = document.getElementById('playerCards');
            const dealerCardsDiv = document.getElementById('dealerCards');

            hand.playerHand.forEach(card => {
                playerCardsDiv.innerHTML += createCardHTML(card);
            });

            hand.dealerHand.forEach((card, index) => {
                dealerCardsDiv.innerHTML += createCardHTML(card);
            });

            // Display values
            document.getElementById('playerValue').textContent = 'Value: ' + hand.playerValue;
            document.getElementById('dealerValue').textContent = 'Value: ' + hand.dealerValue;

            // Display actions
            if (hand.actions && hand.actions.length > 0) {
                document.getElementById('actionsList').textContent = 'Actions: ' + hand.actions.join(' → ');
            }

            // Display result
            let resultHTML = '';
            let resultClass = '';

            switch(hand.result) {
                case 'playerWin':
                    resultHTML = `WIN! +$${hand.profit.toFixed(2)}`;
                    resultClass = 'win';
                    break;
                case 'dealerWin':
                    resultHTML = `LOSE -$${Math.abs(hand.profit).toFixed(2)}`;
                    resultClass = 'lose';
                    break;
                case 'push':
                    resultHTML = 'PUSH - Tie';
                    resultClass = 'push';
                    break;
                case 'playerBlackjack':
                    resultHTML = `BLACKJACK! +$${hand.profit.toFixed(2)}`;
                    resultClass = 'win';
                    break;
                case 'dealerBlackjack':
                    resultHTML = `DEALER BLACKJACK -$${Math.abs(hand.profit).toFixed(2)}`;
                    resultClass = 'lose';
                    break;
                case 'playerBust':
                    resultHTML = `BUST! -$${Math.abs(hand.profit).toFixed(2)}`;
                    resultClass = 'lose';
                    break;
            }

            document.getElementById('resultMessage').innerHTML = 
                `<div class="result-message ${resultClass}">${resultHTML}</div>`;
        }

        function createCardHTML(card) {
            let suit = '';
            let suitClass = '';
            
            switch(card.suit) {
                case '♠': suitClass = 'spades'; suit = '♠'; break;
                case '♥': suitClass = 'hearts'; suit = '♥'; break;
                case '♦': suitClass = 'diamonds'; suit = '♦'; break;
                case '♣': suitClass = 'clubs'; suit = '♣'; break;
            }

            return `<div class="card ${suitClass}">${card.rank}${suit}</div>`;
        }

        function clearTable() {
            document.getElementById('playerCards').innerHTML = '';
            document.getElementById('dealerCards').innerHTML = '';
            document.getElementById('playerValue').textContent = '';
            document.getElementById('dealerValue').textContent = '';
            document.getElementById('actionsList').textContent = '';
        }

        async function updateStats() {
            const response = await fetch('/api/stats');
            const stats = await response.json();

            document.getElementById('statBankroll').textContent = '$' + stats.bankroll.toFixed(2);
            
            const profitElem = document.getElementById('statProfit');
            profitElem.textContent = (stats.profit >= 0 ? '+' : '') + '$' + stats.profit.toFixed(2);
            profitElem.className = 'stat-value ' + (stats.profit >= 0 ? 'positive' : 'negative');
            
            const roiElem = document.getElementById('statROI');
            roiElem.textContent = (stats.roi >= 0 ? '+' : '') + stats.roi.toFixed(2) + '%';
            roiElem.className = 'stat-value ' + (stats.roi >= 0 ? 'positive' : 'negative');
            
            document.getElementById('statHandsPlayed').textContent = stats.handsPlayed;
            document.getElementById('statHandsSat').textContent = stats.handsSatOut;
            
            const winRate = stats.handsPlayed > 0 ? (stats.handsWon / stats.handsPlayed * 100) : 0;
            document.getElementById('statWinRate').textContent = winRate.toFixed(1) + '%';
            
            document.getElementById('statTotalWagered').textContent = '$' + stats.totalWagered.toFixed(2);
            document.getElementById('statMaxBankroll').textContent = '$' + stats.maxBankroll.toFixed(2);
            document.getElementById('statMinBankroll').textContent = '$' + stats.minBankroll.toFixed(2);

            // Update count display
            if (stats.runningCount !== undefined) {
                document.getElementById('runningCount').textContent = stats.runningCount >= 0 ? '+' + stats.runningCount : stats.runningCount;
                document.getElementById('trueCount').textContent = stats.trueCount >= 0 ? '+' + stats.trueCount.toFixed(1) : stats.trueCount.toFixed(1);
                document.getElementById('decksRemaining').textContent = stats.decksRemaining.toFixed(1);
            }
        }

        async function startAutoPlay() {
            autoPlayTarget = parseInt(document.getElementById('autoPlayHands').value);
            autoPlayCount = 0;

            document.getElementById('autoPlayBtn').style.display = 'none';
            document.getElementById('stopAutoBtn').style.display = 'block';
            document.getElementById('playHandBtn').disabled = true;
            document.getElementById('newGameBtn').disabled = true;

            autoPlayInterval = setInterval(async () => {
                if (autoPlayCount >= autoPlayTarget) {
                    stopAutoPlay();
                    return;
                }

                await playHand();
                autoPlayCount++;
                
                // Small delay between hands
                await new Promise(resolve => setTimeout(resolve, 800));
            }, 1000);
        }

        function stopAutoPlay() {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
            }

            document.getElementById('autoPlayBtn').style.display = 'block';
            document.getElementById('stopAutoBtn').style.display = 'none';
            document.getElementById('playHandBtn').disabled = false;
            document.getElementById('newGameBtn').disabled = false;
        }
    </script>
</body>
</html>
